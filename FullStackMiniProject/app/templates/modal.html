<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Buyer Dashboard - BidHub</title>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link rel="stylesheet" href="../static/styles.css"/>
</head>
<body>
  <nav>
    <a href="/" class="logo">
      <i class="fas fa-gavel"></i> BidHub
    </a>
    <div class="nav-links">
      <a href="{{ url_for('buyer') }}" class="active">
        <i class="fas fa-shopping-cart"></i> Buyer
      </a>
      <a href="{{ url_for('seller') }}">
        <i class="fas fa-plus-circle"></i> Seller
      </a>
      <a href="{{ url_for('profile') }}">
        <i class="fas fa-user"></i> Profile
      </a>
    </div>
    <div class="user-info">
      <div class="notification-icon" onclick="toggleNotifications()">
        <i class="fas fa-bell"></i>
        <span class="notification-badge">3</span>
      </div>
      <span>Welcome, {{ name }}!</span>
      <a href="/" class="logout-btn">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </nav>

  <div id="notificationPanel" class="notification-panel hidden">
    <div class="notification-header">
      <h3><i class="fas fa-bell"></i> Notifications</h3>
      <button onclick="toggleNotifications()" class="close-btn">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="notification-list">
      <div class="notification-item unread">
        <div class="notification-icon won">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="notification-content">
          <h4>Congratulations! You won an auction</h4>
          <p>MacBook Pro 2023 - Like New for $1,350.00</p>
          <span class="notification-time">2 hours ago</span>
        </div>
      </div>
      <div class="notification-item unread">
        <div class="notification-icon outbid">
          <i class="fas fa-arrow-up"></i>
        </div>
        <div class="notification-content">
          <h4>You've been outbid</h4>
          <p>Canon EOS R5 Professional Camera - Current bid: $2,950.00</p>
          <span class="notification-time">4 hours ago</span>
        </div>
      </div>
      <div class="notification-item">
        <div class="notification-icon outbid">
          <i class="fas fa-arrow-up"></i>
        </div>
        <div class="notification-content">
          <h4>You've been outbid</h4>
          <p>PlayStation 5 Console Bundle - Current bid: $725.00</p>
          <span class="notification-time">1 day ago</span>
        </div>
      </div>
    </div>
    <div class="notification-footer">
      <button onclick="markAllAsRead()" class="mark-read-btn">Mark all as read</button>
    </div>
  </div>

  <div class="main-content">
    <div class="page-header">
      <h1><i class="fas fa-shopping-cart"></i> Current Auctions</h1>
      <p>Discover amazing deals and place your bids on the latest items. Items are sorted from newest to oldest.</p>
    </div>

    <!-- === PRODUCT DISPLAY SECTION === -->
    <div class="products-grid">
      {% for product, time_left in zip(products, time_lefts) %}
        <div class="product-card">
          <div class="product-image">
            <img src="data:image/png;base64,{{ product.image_base64 }}">
          </div>
          <div class="product-info">
            <h3 class="product-title">{{ product.title }}</h3>
            <p class="product-description">
              {{ product.description }}
            </p>
            <div class="product-meta">
              <span class="current-bid">${{ product.price }}</span>
              <span class="time-left">{{ time_left }}</span>
            </div>
            <button class="bid-button" onclick="openBidModal('{{ product.product_id }}', '{{ product.title }}', '{{ product.price }}')">
              <i class="fas fa-gavel"></i> Place Bid
            </button>
          </div>
        </div>
      {% endfor %}
      <!-- Sample Product 1 -->
      <div class="product-card">
        <div class="product-image">
          <i class="fas fa-laptop" style="font-size: 3em; color: var(--primary-color);"></i>
        </div>
        <div class="product-info">
          <h3 class="product-title">MacBook Pro 2023 - Like New</h3>
          <p class="product-description">
            13-inch MacBook Pro with M2 chip, 8GB RAM, 256GB SSD. Excellent condition, barely used.
          </p>
          <div class="product-meta">
            <span class="current-bid">$1,250.00</span>
            <span class="time-left">2h 15m left</span>
          </div>
          <button class="bid-button" onclick="openBidModal('PRD001', 'MacBook Pro 2023 - Like New', 1250.00)">
            <i class="fas fa-gavel"></i> Place Bid
          </button>
        </div>
      </div>

      <!-- Sample Product 2 -->
      <div class="product-card">
        <div class="product-image">
          <i class="fas fa-camera" style="font-size: 3em; color: var(--accent-color);"></i>
        </div>
        <div class="product-info">
          <h3 class="product-title">Canon EOS R5 Professional Camera</h3>
          <p class="product-description">
            Professional mirrorless camera with 45MP sensor. Includes original box and accessories.
          </p>
          <div class="product-meta">
            <span class="current-bid">$2,800.00</span>
            <span class="time-left">5h 42m left</span>
          </div>
          <button class="bid-button" onclick="openBidModal('PRD002', 'Canon EOS R5 Professional Camera', 2800.00)">
            <i class="fas fa-gavel"></i> Place Bid
          </button>
        </div>
      </div>

      <!-- Sample Product 3 -->
      <div class="product-card">
        <div class="product-image">
          <i class="fas fa-gem" style="font-size: 3em; color: var(--success-color);"></i>
        </div>
        <div class="product-info">
          <h3 class="product-title">Vintage Diamond Ring</h3>
          <p class="product-description">
            Beautiful vintage diamond engagement ring, 1.5 carat, certified authentic with appraisal.
          </p>
          <div class="product-meta">
            <span class="current-bid">$3,500.00</span>
            <span class="time-left">1d 3h left</span>
          </div>
          <button class="bid-button" onclick="openBidModal('PRD003', 'Vintage Diamond Ring', 3500.00)">
            <i class="fas fa-gavel"></i> Place Bid
          </button>
        </div>
      </div>

      <!-- Sample Product 4 -->
      <div class="product-card">
        <div class="product-image">
          <i class="fas fa-gamepad" style="font-size: 3em; color: var(--warning-color);"></i>
        </div>
        <div class="product-info">
          <h3 class="product-title">PlayStation 5 Console Bundle</h3>
          <p class="product-description">
            Brand new PS5 console with extra controller and 3 popular games included.
          </p>
          <div class="product-meta">
            <span class="current-bid">$650.00</span>
            <span class="time-left">3d 12h left</span>
          </div>
          <button class="bid-button" onclick="openBidModal('PRD004', 'PlayStation 5 Console Bundle', 650.00)">
            <i class="fas fa-gavel"></i> Place Bid
          </button>
        </div>
      </div>

      <!-- Sample Product 5 -->
      <div class="product-card">
        <div class="product-image">
          <i class="fas fa-paint-brush" style="font-size: 3em; color: var(--accent-color);"></i>
        </div>
        <div class="product-info">
          <h3 class="product-title">Original Oil Painting - Landscape</h3>
          <p class="product-description">
            Beautiful original landscape painting by local artist. Framed and ready to hang.
          </p>
          <div class="product-meta">
            <span class="current-bid">$425.00</span>
            <span class="time-left">6d 8h left</span>
          </div>
          <button class="bid-button" onclick="openBidModal('PRD005', 'Original Oil Painting - Landscape', 425.00)">
            <i class="fas fa-gavel"></i> Place Bid
          </button>
        </div>
      </div>

      <!-- Sample Product 6 -->
      <div class="product-card">
        <div class="product-image">
          <i class="fas fa-bicycle" style="font-size: 3em; color: var(--primary-color);"></i>
        </div>
        <div class="product-info">
          <h3 class="product-title">Mountain Bike - Trek 2022</h3>
          <p class="product-description">
            High-performance mountain bike, lightly used. Perfect for trails and outdoor adventures.
          </p>
          <div class="product-meta">
            <span class="current-bid">$890.00</span>
            <span class="time-left">1w 2d left</span>
          </div>
          <button class="bid-button" onclick="openBidModal('PRD006', 'Mountain Bike - Trek 2022', 890.00)">
            <i class="fas fa-gavel"></i> Place Bid
          </button>
        </div>
      </div>
    </div>
    <!-- === END PRODUCT DISPLAY SECTION === -->

  </div>

  <!-- Bid Modal -->
  <div id="bidModal" class="modal">
    <form action="{{ url_for('bid', product_id=selected_product.product_id) }}" method="POST" class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-gavel"></i> Place Your Bid</h2>
        <a href="{{ url_for('buyer') }}" class="close-modal" style="text-decoration: none;">
          <i class="fas fa-times"></i>
        </a>
      </div>
      <div class="modal-body">
        <div class="bid-product-info">
          <h3 id="bidProductName">Product Name: {{ selected_product.title }}</h3>
          <div class="current-high-bid">
            <span>Current Highest Bid:</span>
            <strong id="currentBidAmount">${{ selected_product.price}}</strong>
          </div>
        </div>

        <div class="bids-history">
          <h4><i class="fas fa-history"></i> Bid History</h4>
          <div class="bids-list" id="bidsList">
            {% for history in histories %}
            <div class="bid-item">
              <div class="bidder-info">
                <div class="bidder-avatar">
                  <i class="fas fa-user"></i>
                </div>
                <div>
                  <div class="bidder-name">{{ history.bidder }}</div>
                  <div class="bid-time">{{ history.time }}</div>
                </div>
              </div>
              <div class="bid-amount">${{ history.amount }}</div>
            </div>
            {% endfor %}
          </div>
        </div>

        <div class="bid-form">
          <div class="form-group">
            <label for="bidAmount">Your Bid Amount ($)</label>
            <input 
              type="number" 
              id="bidAmount" 
              name="bidAmount"
              step="5" 
              min="{{ int(selected_product.price) + 5 }}" 
              value="{{ int(selected_product.price) + 5 }}"
              onchange="summary()"
            >
            <div class="bid-help">
              <small>Minimum bid: $<span id="minBid">{{ int(selected_product.price) + 5 }}</span></small>
            </div>
          </div>
          
          <div class="bid-summary">
            <div class="summary-item">
              <span>Your Bid:</span>
              <span id="summaryBid">${{ int(selected_product.price) + 5 }}</span>
            </div>
            <div class="summary-item">
              <span>Service Fee (5%):</span>
              <span id="summaryFee">${{ (int(selected_product.price) + 5) * 5 / 100}}</span>
            </div>
            <div class="summary-item total">
              <span>Total:</span>
              <span id="summaryTotal">${{ (int(selected_product.price) + 5) * 105 / 100}}</span>
            </div>
          </div>

          <div class="bid-terms">
            <label class="checkbox-option">
              <input type="checkbox" id="agreeTerms">
              <span>I agree to the <a href="#">Bidding Terms</a> and understand this is a binding offer</span>
            </label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-cancel" onclick="exit()">Cancel</button>
        <button type="submit" class="btn-confirm" id="confirmBidBtn">Place Bid</button>
      </div>
    </form>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>

    function summary(){
      var price = document.getElementById('bidAmount').value
      document.getElementById('summaryBid').innerHTML = '$' + price
      document.getElementById('summaryFee').innerHTML = '$' + price * 5 / 100
      document.getElementById('summaryTotal').innerHTML = '$' + price * 105 / 100
    }

    function exit(){
      window.location.href = "{{ url_for('buyer') }}"
    }

    // Event listeners for real-time updates
    document.addEventListener('DOMContentLoaded', function() {
      
      // Close modal when clicking outside
      document.getElementById('bidModal').addEventListener('click', function(e) {
        if (e.target === this) {
          window.location.href = "{{ url_for('buyer') }}"
        }
      });
    });


  </script>
</body>
</html>